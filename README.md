# ğŸ‰ gRPC Gateway Implementation ğŸ‰

### **If an HTTP API is worth a dollar, its gRPC counterpart is like 20 cents more**.
<div style="text-align: right; margin-top: -4px">- Lionel Messi. </div>

---
**And now** with _`GRPC Gateway`_ we get both of them for only... _**$0.75!!!**_ ğŸ˜± With extra fries and a refreshing _Monster Mango Locoâ„¢_ free of charge. ğŸŸğŸ¥¤ 

... _**What?**_ ğŸ¤¨ You're not making any sense.

**Let's say** we define a `UsersService` in a `.proto` file. We can _leverage_ `gRPC Gateway` to generate an **HTTP Gateway** that can connect to a **gRPC Server** (also auto-generated) that in turn can connect to that `UsersService`. ğŸ¤¯ For free!

... But wasn't it _$0.75_? ğŸ¤”

**Yes, but** if you buy now, we'll throw in a `Swagger Spec` for your HTTP API, which is also of course auto-generated by the annotations on the `.proto`. ğŸ‰ Validations are also done that way, _so there is practically no Transport Layer~_.

... OK............. That's actually cool...... ğŸ¤‘ Gimme 7.

# Code Generation ğŸ–¥ï¸

The best thing about using **`.proto`** files is that you define your API before implementing it. 

With custom annotations on the **`.proto`** file and tools like `gRPC Gateway` you get an HTTP Handler for each gRPC Method, each Handler decoding HTTP Requests into gRPC ones, calling their designated method on the gRPC Server and encoding the gRPC Response back into HTTP.

<div style="margin-bottom: -16px">
You also get a Validation Layer based on the protofile. And did I mention the free Swagger? ğŸ˜ It's <i>$11.99</i>.
 <p style="display: inline-block;font-size:8px">Plus taxes.</p>
</div>

## So what's in here? ğŸ‘€

_**~I'm glad you ask!**_ - We have **`two simple APIs: 1 gRPC & 1 HTTP`**, with 4 endpoints each -> **Signup** and **Login** and **GetUser** and **GetUsers**.

**_It leverages_ ->** Clean & Hexagonal Architecture ğŸ”· / MySQL ğŸ¬ / Patterns and Good Practices ğŸ“ / Great Documentation ğŸ“š / GORM ğŸŒ± / Centralized Error Handling ğŸ¯ / JWT ğŸ”‘ / TLS ğŸ”’ / RBAC ğŸ‘‘ / GCP âŒ / JJR â“ / Y2K ğŸ¤” / Swagger Spec ğŸ“œ / BRB ğŸ¤¦â€â™‚ï¸ / LOL ğŸ˜‚ / Postman Automation ğŸ“¬ / AFK ğŸƒâ€â™€ï¸

# Request lifecycle ğŸ”„

â¡ï¸ When an HTTP Request hits the Gateway, the first file to be called is

*  **`users.pb.gw.go`** -> `RegisterUsersServiceHandlerClient` -> `request_UsersService_Signup_0`

â¡ï¸ Then, when it needs to go through the **`google.golang.org/grpc/server.go`**, it calls

*  **`users_grpc.pb.go`** -> `usersServiceClient.Signup` -> `_UsersService_Signup_Handler`

â¡ï¸ Followed by our interceptors in 

*  **`grpc_interceptors.go`** -> `rateLimiterInterceptor` -> `loggerInterceptor` -> `tokenValidationInterceptor` -> `inputValidationInterceptor` -> `contextCancelledInterceptor`

â¡ï¸ To finally reach

*  **`service_users.go`** -> `service.Signup`

# Useful Commands âœğŸ¼

**`make all`**: Makes all.

ğŸ¤ª It cleans the env, generates code, runs tests, and runs the app.

**`make all fast=1`**: Makes all, but faster. Skips cleaning and testing.

**`make help`**: Shows help message. 

**`make run`**: Updates `go.mod` and runs app.

**`make generate`**: Based on the `.proto` files, generates the `.pb.go` files and Swagger Documentation.

For more commands, check the `Makefile`. ğŸŒˆ

# Auto Generated Files ğŸ•¸

## users.pb.go
**Protobuf Types and their methods, as defined in the .proto.**

SignupRequest / SignupResponse / LoginRequest / LoginResponse / UserInfo / PaginationInfo. 

## users_grpc.pb.go

**GRPC Server and Client, endpoints registration.**

<div>type UsersServiceClient interface</div>
<div>type UsersServiceServer interface</div>

<div style='margin-top: 16px'>func RegisterUsersServiceServer(...)</div>

## users.pb.gw.go
**Reverse proxy, decodes HTTP into GRPC and viceversa.**

<div>request_UsersService_Signup_0(...)</div>
<div>request_UsersService_Login_0(...)</div>
<div>request_UsersService_GetUser_0(...)</div>
<div>request_UsersService_GetUsers_0(...)</div>

<div style='margin-top: 16px'>RegisterUsersServiceHandler(...)</div>
<div>RegisterUsersServiceHandlerFromEndpoint(...)</div>

## IG @gilperopiola ğŸ¿